@model PagedList.IPagedList<PayrollSystem.Models.Employee>
@using PagedList.Mvc;
<link href="~/Content/PagedList.css" rel="stylesheet" type="text/css" />
@{

    ViewBag.Title = ViewBag.Action;
}
<h3 class="text-default">Job Order - @ViewBag.Action</h3>
<div class="box-tools pull-right">
    <!-- Buttons, labels, and many other things can be placed here! -->
    <!-- Here is a label for example -->
    <span><i class="glyphicon glyphicon-user"></i></span>
</div>
<div class="box box box-default"> 
    @using (Html.BeginForm("JobOrder", "Home", FormMethod.Get, new { @class = "navbar-form"}))
    {
            <div class="input-group add-on">
                <input class="form-control" placeholder="Search" name="search" value="@ViewBag.Search" id="srch-term" type="text">
                <div class="input-group-btn">
                    <button class="btn btn-default" type="submit" ><i class="glyphicon glyphicon-search"></i></button>
                </div>
            </div>    
    }
    <!-- /.box-header -->
    <div class="box-body">
        
        <table class="table">
            <tr>
                <th>ID NO</th>
                <th>FIRST NAME</th>
                <th>MIDDLE NAME</th>
                <th>LASTNAME</th>
                <th>DESIGNATION</th>
                <th>SALARY</th>
                <th></th>
            </tr>

            @foreach (var item in Model)
            {
                <tr>
                    <td class="@item.ID">
                        @Html.DisplayFor(modelItem => item.ID)
                    </td>
                    <td class="@item.ID">
                        @Html.DisplayFor(modelItem => item.Firstname)
                    </td>
                    <td class="@item.ID">
                        @Html.DisplayFor(modelItem => item.Middlename)
                    </td>
                    <td class="@item.ID">
                        @Html.DisplayFor(modelItem => item.Lastname)
                    </td>
                    <td class="@item.ID">
                        @Html.DisplayFor(modelItem => item.Designation)
                    </td>
                    <td class="@item.ID">
                        @Html.DisplayFor(modelItem => item.Salary)
                    </td>
                    <td class="hidden">
                        @item.CoopFormat()
                    </td>
                    <td class="hidden">
                        @item.PagibigFormat()
                    </td>
                    <td class="hidden">
                        @item.GsisFormat()
                    </td>
                    <td class="hidden">
                        @item.PhicFormat()
                    </td>
                    <td class="hidden">
                        @item.ExcessFormat()
                    </td>
                    <td>
                        <button class="btn btn-xs btn-success create_jo_payroll"><i class="glyphicon glyphicon-plus-sign"></i></button>
                        <button class="btn btn-xs btn-success view_payroll_list"><i class="glyphicon glyphicon-info-sign"></i></button>
                    </td>
                </tr>

            }
        </table>
    </div>
    <!-- /.box-body -->
    <div class="box-footer">
        Page @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber) of @Model.PageCount

        @Html.PagedListPager(Model, page => Url.Action("JobOrder",
 new { page, search = ViewBag.Search }))
    </div>
</div>

<div class="row">
    <div class="col-md-6">

        <div class="box box box-default hide" id="box_create_payroll">
            <div class="box-header with-border">
                <h1 class="box-title"><b>Create Payroll</b></h1>
                <div class="box-tools pull-right">
                    <!-- Buttons, labels, and many other things can be placed here! -->
                    <!-- Here is a label for example -->
                    <button class="btn btn-xs btn-danger remove_create_jo_payroll"><i class="glyphicon glyphicon-remove"></i></button>
                </div>
            </div>
            <div class="box-body">
             
                    <input type="text" class="hidden" id="jo_date_range" />
                    <input type="text" class="hidden" id="jo_id" name="jo_id" />
                    <input type="text" class="hidden" id="jo_payroll_id" name="jo_payroll_id" readonly />
                    <div class="row">
                        <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                            <div class="form-group">
                                <label>Month</label>
                                <select name="jo_month" id="jo_month" class="form-control" required>
                                    <option value="0">Select Month</option>
                                    <option value="1">January</option>
                                    <option value="2">Februrary</option>
                                    <option value="3">March</option>
                                    <option value="4">April</option>
                                    <option value="5">May</option>
                                    <option value="6">June</option>
                                    <option value="7">July</option>
                                    <option value="8">August</option>
                                    <option value="9">September</option>
                                    <option value="10">October</option>
                                    <option value="11">November</option>
                                    <option value="12">December</option>
                                </select>
                            </div>
                        </div>

                        <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                            <div class="form-group">
                                <label>Year</label>
                                <select name="jo_year" id="jo_year" class="form-control" required>
                                    <option value="0">Select Year</option>
                                    @for (int i = 2018; i <= DateTime.Now.Year; i++)
                                    {
                                        <option value="@i">@i</option>
                                    }

                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                            <div class="form-group">
                                <label>Options</label>
                                <select name="jo_month_range" id="jo_month_range" class="form-control" required>
                                    <option value="0">Select Range</option>
                                    <option value="1">First Half of Month</option>
                                    <option value="2">Second Half of Month</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                            <div class="form-group">
                                <label>Adjustment</label>
                                <input type="text" class="form-control input-data" id="jo_adjustment" name="jo_adjustment" value="0.00" required />
                            </div>
                        </div>
                    </div>
            
                    <div>
                        <div class="row">
                            <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                <div class="form-group">
                                    <label>Monthly Rate</label>
                                    <input type="text" name="jo_salary" id="jo_salary" class="form-control input-data" required readonly />
                                </div>
                            </div>
                            <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                <div class="form-group">
                                    <label>Working Days</label>
                                    <input type="text" class="form-control input-data" id="jo_working_days" name="jo_working_days" value="0" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                <div class="form-group">
                                    <label>Minutes (Late/Undertime)</label>
                                    <input type="text" id="jo_minutes_late" name="jo_minutes_late" class="form-control input-data" value="0" required />
                                </div>
                            </div>
                            <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                <div class="form-group">
                                    <label>Absent Days</label>
                                    <input type="text" class="form-control" id="jo_absent_date" name="jo_absent_date" placeholder="Choose Date" readonly />
                                    <input type="text" class="form-control hidden" id="jo_absent_date_list" name="jo_absent_date_list" />
                                </div>
                                <div class="form-group">
                                    <table id="jo_date_list" name="jo_date_list" class="table table-dark"></table>
                                </div>
                            </div>
                        </div>

                        <div class="create_payroll_spinner hidden">
                            <div class="cold-md-12">
                                <center><img src="@Url.Content("~/Images/spin.gif")" width="150" style="padding:20px;"></center>
                            </div>
                        </div>


                        <div class="row">
                            <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                <div class="form-group">
                                    <label>Deduction(Late/Undertime/Absent)</label>
                                    <input type="text" class="form-control" id="jo_deduction" name="jo_deduction" value="0.00" readonly />
                                </div>
                            </div>
                            <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                <div class="form-group">
                                    <label>Net Amount</label>
                                    <input type="text" class="form-control" id="jo_net_amount" name="jo_net_amount" value="0.00" readonly />
                                </div>
                            </div>
                        </div>

                        <hr />

                        <div class="row">
                            <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                <div class="form-group">
                                    <label>5% EWT</label>
                                    <input type="tel" class="form-control" id="jo_ewt" name="jo_ewt" value="0.00" required />
                                </div>
                            </div>
                            <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                <div class="form-group">
                                    <label>3% Professional Tax</label>
                                    <input type="text" class="form-control input-data" id="jo_prof_tax" name="jo_prof_tax" value="0.00" required />
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                <table>
                                    <tr>
                                      
                                        <td>
                                            <div class="form-group">
                                                <label>Coop</label>
                                                <input type="text" class="form-control input-data input-group" id="jo_coop" name="jo_coop" value="0.00" required readonly/>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="form-group">
                                                <label>No. Payment</label>
                                                <input type="text" class="form-control input-data input-group" id="jo_coop_payment" required readonly />

                                            </div>
                                        </td>
                                        <td>
                                            <div class="form-group">
                                                <label>No. Paid</label>
                                               
                                                    <div class="input-group add-on">
                                                        <input type="text" class="form-control input-data input-group" id="jo_coop_paid" required readonly />
                                                        <div class="input-group-btn">
                                                            <button class="btn btn-success" id="edit_coop" value="coop" type="button"><i id="coop_icon" class="glyphicon glyphicon-pencil"></i></button>
                                                        </div>
                                                    </div>
                                            </div>
                                        </td>
                                      
                                    </tr>
                                </table>

                            </div>

                            <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                <div class="form-group">
                                    <label>Other Adjustment</label>
                                    <input type="text" class="form-control" id="jo_other_adjustment" name="jo_other_adjustment" value="0.00" required />
                                </div>
                            </div>

                        </div>
                        <div class="row">
                            <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                <table>
                                    <tr>
                                        <td>
                                            <div class="form-group">
                                                <label>Pag-Ibig</label>
                                                <input type="text" class="form-control input-data" id="jo_pagibig" name="jo_pagibig" value="0.00" readonly required />
                                            </div>
                                        </td>
                                        <td>
                                            <div class="form-group">
                                                <label>No. Payment</label>
                                                <input type="text" class="form-control input-data" id="jo_pagibig_payment" required readonly />
                                            </div>
                                        </td>
                                        <td>
                                            <div class="form-group">
                                                <label>No. Payment</label>
                                                <div class="input-group add-on">
                                                    <input type="text" class="form-control input-data" id="jo_pagibig_paid" required readonly />
                                                    <div class="input-group-btn">
                                                        <button class="btn btn-success" id="edit_pagibig" value="pagibig" type="button"><i id="pagibig_icon" class="glyphicon glyphicon-pencil"></i></button>
                                                    </div>
                                                </div>
                                                
                                            </div>
                                        </td>
                                    </tr>
                                </table>

                            </div>
                            <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                <table>
                                    <tr>
                                        <td>
                                            <div class="form-group">
                                                <label>PHIC</label>
                                                <input type="text" class="form-control input-data" id="jo_phic" name="jo_phic" readonly required />
                                            </div>
                                        </td>
                                        <td>
                                            <div class="form-group">
                                                <label>No. Payment</label>
                                                <input type="text" class="form-control input-data" id="jo_phic_payment" required readonly />
                                            </div>
                                        </td>
                                        <td>
                                            <div class="form-group">
                                                <label>No. Paid</label>
                                                <div class="input-group add-on">
                                                    <input type="text" class="form-control input-data" id="jo_phic_paid" required readonly />
                                                    <div class="input-group-btn">
                                                        <button class="btn btn-success" id="edit_phic" value="phic" type="button"><i id="phic_icon" class="glyphicon glyphicon-pencil"></i></button>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </table>

                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                <table>
                                    <tr>
                                        <td>
                                            <div class="form-group">
                                                <label>GSIS</label>
                                                <input type="text" class="form-control input-data" id="jo_gsis" name="jo_gsis" readonly required />
                                            </div>
                                        </td>
                                        <td>
                                            <div class="form-group">
                                                <label>No. Payment</label>
                                                <input type="text" class="form-control input-data" id="jo_gsis_payment" required readonly />
                                            </div>
                                        </td>
                                        <td>
                                            <div class="form-group">
                                                <label>No. Paid</label>
                                                <div class="input-group add-on">
                                                    <input type="text" class="form-control input-data" id="jo_gsis_paid" required readonly />
                                                    <div class="input-group-btn">
                                                        <button class="btn btn-success" id="edit_gsis" value="gsis" type="button"><i id="gsis_icon" class="glyphicon glyphicon-pencil"></i></button>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </table>

                            </div>
                            <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                <table>
                                    <tr>
                                        <td>
                                            <div class="form-group">
                                                <label>Excess Mobile</label>
                                                <input type="text" class="form-control input-data" id="jo_excess" name="excess" readonly required />
                                            </div>
                                        </td>
                                        <td>
                                            <div class="form-group">
                                                <label>No. Payment</label>
                                                <input type="text" class="form-control input-data" id="jo_excess_payment" required readonly />
                                            </div>
                                        </td>
                                        <td>
                                            <div class="form-group">
                                                <label>No. Paid</label>
                                                <div class="input-group add-on">
                                                    <input type="text" class="form-control input-data" id="jo_excess_paid" required readonly />
                                                    <div class="input-group-btn">
                                                        <button class="btn btn-success" id="edit_excess" value="excess" type="button"><i id="excess_icon" class="glyphicon glyphicon-pencil"></i></button>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </table>

                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                <div class="form-group">
                                    <label>Total Deductions</label>
                                    <input type="text" class="form-control" id="jo_total_deductions" name="jo_total_deductions" value="0.00" readonly />
                                </div>
                            </div>
                            <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                <div class="form-group">
                                    <label>Net Pay</label>
                                    <input type="text" class="form-control" id="jo_total_amount" name="jo_total_amount" value="0.00" readonly />
                                </div>
                            </div>
                        </div>
                        <hr />
                        <div class="row">
                            <div class="col-md-12 col-lg-12 col-sm-12 col-xs-12">
                                <div class="form-group">
                                    <label>Remarks</label>
                                    <textarea rows="7" id="jo_remarks" name="jo_remarks" class="form-control"></textarea>
                                </div>
                            </div>
                        </div>
                        <hr />
                    </div>
                    <div class="row">
                        <div class="col-md-4 col-md-offset-4 col-sm-4 col-sm-offset-4 col-xs-4 col-xs-offset-4">
                            <button type="button" class="btn btn-primary form-control" id="jo_save" value="Save">Save</button>
                        </div>
                    </div>
             
            </div>
        </div>
     
    </div>
    <div class="col-md-6">
        <div class="box box box-default hide" id="box_jo_payroll_list">
            <div class="box-header with-border">
                <h1 class="box-title"><b>Payroll List</b></h1>
                <div class="box-tools pull-right">
                    <!-- Buttons, labels, and many other things can be placed here! -->
                    <!-- Here is a label for example -->
                    <button class="btn btn-xs btn-danger remove_payroll_list"><i class="glyphicon glyphicon-remove"></i></button>
                </div>
                <!-- /.box-tools -->
            </div>
            <!-- /.box-header -->
            <div class="box-body">
               <div class="parent-payroll-list">
                 
               </div>
            </div>
            <!-- /.box-body -->
        </div>
    </div>
</div> 

@section scripts{
<script>

    $(document).ready(function () {

        $("#jo_working_days, #jo_minutes_late,#jo_adjustment").change(function () {
            ComputeDeductions();
        });

        $("#jo_adjustment").change(function () {
            $(this).val(formatComma(roundOff($(this).val())));
            ComputeDeductions();
        });
        $("#jo_save").click(function () {

            var jo_id = $("#jo_id").val();
            var start_date = $("#jo_date_range").val().split('-')[0];
            var end_date = $("#jo_date_range").val().split('-')[1];
            var adjustment = $("#jo_adjustment").val();
            var working_days = $("#jo_working_days").val();
            var absent_date_list = $("#jo_absent_date_list").val();
            var salary = $("#jo_salary").val();
            var minutes_late = $("#jo_minutes_late").val();
            var prof_tax = $("#jo_prof_tax").val();
            var jo_ewt = $("#jo_ewt").val();
            var coop = $("#jo_coop").val();
            var other_adjustment = $("#jo_other_adjustment").val();
            var pagibig = $("#jo_pagibig").val();
            var excess = $("#jo_excess").val();
            var phic = $("#jo_phic").val();
            var gsis = $("#jo_gsis").val();
            var remarks = $("#jo_remarks").val();

            var url = "@Url.Action("InsertJoPayroll", "Home")";
            $.ajax({
                url: url,
                type: "POST",
                data: {
                    jo_id: jo_id,
                    start_date: start_date,
                    end_date: end_date,
                    adjustment: removeComma(adjustment),
                    working_days: working_days,
                    absent_date_list: absent_date_list,
                    salary: removeComma(salary),
                    minutes_late: minutes_late,
                    prof_tax: removeComma(prof_tax),
                    jo_ewt: removeComma(jo_ewt),
                    coop: removeComma(coop),
                    other_adjustment: removeComma(other_adjustment),
                    pagibig: removeComma(pagibig),
                    excess: removeComma(excess),
                    phic: removeComma(phic),
                    gsis: removeComma(gsis),
                    remarks: remarks
                },
                success: function (flag) {
                    alert(flag);
                }
            });

        });

        $("#edit_coop,#edit_pagibig,#edit_phic,#edit_gsis,#edit_excess").click(function () {

            var type = $(this).val();

            var icon = $("#" + type + "_icon");

            if (icon.hasClass("glyphicon-pencil")) {

                $("#jo_" + type + "").attr("readonly", false);
                $("#jo_" + type + "_payment").attr("readonly", false);
                $("#jo_" + type + "_paid").attr("readonly", false);

                $("#" + type + "_icon").removeClass("glyphicon-pencil");
                $("#" + type + "_icon").addClass("glyphicon-check");
                return;

            } 

            if (icon.hasClass("glyphicon-check") || icon.hasClass("glyphicon-repeat")) {

                var url = "@Url.Action("UpdateRemittance", "Home")";
                var amount = $("#jo_" + type + "").val().replace(/,/g, '');
                var payment = $("#jo_" + type + "_payment").val().replace(/,/g, '');
                var paid = $("#jo_" + type + "_paid").val().replace(/,/g, '');
                var emp_id = $("#jo_id").val();

                $("#" + type + "_icon").removeClass("glyphicon-check");
                $("#" + type + "_icon").removeClass("glyphicon-repeat");
                $("#" + type + "_icon").addClass("fa fa-spinner fa-spin");

                $.ajax({
                    url: url,
                    type: "POST",
                    data: {
                        table: type+"_remittance",
                        ID: 1,
                        UserID: emp_id,
                        MaxCount: payment,
                        Count: paid,
                        Amount:amount
                    },
                    success: function (flag) {
                        if (flag) {
                            $("#jo_" + type + "").attr("readonly", true);
                            $("#jo_" + type + "_payment").attr("readonly", true);
                            $("#jo_" + type + "_paid").attr("readonly", true);

                            $("#edit_" + type + "").removeClass("btn-danger");
                            $("#edit_" + type + "").addClass("btn-success");

                            $("#" + type + "_icon").removeClass("fa fa-spinner fa-spin");
                            $("#" + type + "_icon").addClass("glyphicon-pencil");
                        } else {
                            $("#edit_" + type + "").removeClass("btn-success");
                            $("#edit_" + type + "").addClass("btn-danger");

                            $("#" + type + "_icon").removeClass("fa fa-spinner fa-spin");
                            $("#" + type + "_icon").addClass("glyphicon-repeat");
                        }  
                    }
                });
                return;
            } 
        });
     
            $("#jo_month, #jo_year, #jo_month_range").change(function () {
                var choosen_month = $("#jo_month").val();
                var choosen_year = $("#jo_year").val();
                if (choosen_month <= 9) choosen_month = "0" + choosen_month;
                var choosen_options = $("#jo_month_range").val();

                if (choosen_month != "00" && choosen_year != "0" && choosen_options != "0") {
                    var id = $("#jo_id").val();
                    switch (choosen_options) {
                        case "1":
                           

                            var from = choosen_year + "-" + choosen_month + "-01";
                            var to = choosen_year + "-" + choosen_month + "-15";

                            $("#jo_date_range").val(choosen_year + "/" + choosen_month + "/01-" + choosen_year + "/" + choosen_month + "/15");
                            getLateAndAbsences(id, from , to);
                            break;
                        case "2":
                            var from = choosen_year + "-" + choosen_month + "-16";
                            var to = choosen_year + "-" + choosen_month + "-" + daysInMonth(parseInt(choosen_month), choosen_year);

                            $("#jo_date_range").val(choosen_year + "/" + choosen_month + "/16-" + choosen_year + "/" + choosen_month + "/" + daysInMonth(parseInt(choosen_month), choosen_year));
                            getLateAndAbsences(id, from, to);
                            break;
                    }
                }

            });
          
            
            $(".remove_create_jo_payroll").click(function () {
                $('#box_create_payroll').addClass("hide");
            });
    
            $('.create_jo_payroll').click(function () {

           
                var id = $(this).closest('tr').find('td:eq(0)').text().trim();
                var salary = $(this).closest('tr').find('td:eq(5)').text().trim();

                var coop = $(this).closest('tr').find('td:eq(6)').text().trim();
                var pagibig = $(this).closest('tr').find('td:eq(7)').text().trim();
                var gsis = $(this).closest('tr').find('td:eq(8)').text().trim();
                var phic = $(this).closest('tr').find('td:eq(9)').text().trim();
                var excess = $(this).closest('tr').find('td:eq(10)').text().trim();

                $(".selected").removeClass("selected");
                $("." + id).addClass("selected");

                $('#box_create_payroll').removeClass("hide");

                $("#jo_salary").val(formatComma(salary));
                $("#jo_id").val(id);

                $("#jo_coop").val(formatComma(coop.split('/')[0]));
                $("#jo_coop_payment").val(coop.split('/')[1]);
                $("#jo_coop_paid").val(coop.split('/')[2]);

                $("#jo_pagibig").val(formatComma(pagibig.split('/')[0]));
                $("#jo_pagibig_payment").val(pagibig.split('/')[1]);
                $("#jo_pagibig_paid").val(pagibig.split('/')[2]);

                $("#jo_gsis").val(formatComma(gsis.split('/')[0]));
                $("#jo_gsis_payment").val(gsis.split('/')[1]);
                $("#jo_gsis_paid").val(gsis.split('/')[2]);

                $("#jo_phic").val(formatComma(phic.split('/')[0]));
                $("#jo_phic_payment").val(phic.split('/')[1]);
                $("#jo_phic_paid").val(phic.split('/')[2]);

                $("#jo_excess").val(formatComma(excess.split('/')[0]));
                $("#jo_excess_payment").val(excess.split('/')[1]);
                $("#jo_excess_paid").val(excess.split('/')[2]);



               
            });

            $('.view_payroll_list').click(function () {
                
                    $('#box_jo_payroll_list').removeClass("hide");
                    $(".parent-payroll-list").html("Loading......");

                    var empID = $(this).closest('tr').find('td:eq(0)').text().trim();

                    var firstname = $(this).closest('tr').find('td:eq(1)').text().trim();
                    var middlename = $(this).closest('tr').find('td:eq(2)').text().trim();
                    var lastname = $(this).closest('tr').find('td:eq(3)').text().trim();

                    $(".selected").removeClass("selected");

                    $("." + empID).addClass("selected");

                    var url = "@Url.Action("PayrollList", "PartialView")";

                    $.ajax({
                        url: url,
                        type: "POST",
                        data: {
                            page: 1,
                            empID: empID,
                            firstname: firstname,
                            lastname: lastname,
                            middlename:middlename
                        },
                        success: function (html) {
                            $(".parent-payroll-list").html(html);
                            console.log(html);
                  
                        }
                    });
            });


            $('.remove_payroll_list').click(function () {
                if (!$('#box_jo_payroll_list').hasClass("hide")){
                    $('#box_jo_payroll_list').addClass("hide");
                } 
            });


    });

    $("#jo_absent_date").datepicker().change(function () {

        var choosen_date = $("#jo_absent_date").val();

        var array_date = ($("#jo_absent_date_list").val().length === 0) ? [] : $("#jo_absent_date_list").val().split(',');


        var item = parseInt(choosen_date.split('/')[0]) + "/" + parseInt(choosen_date.split('/')[1]) + "/" + parseInt(choosen_date.split('/')[2]);

        var tr_id = $("#jo_date_list").children().length;

        var date_item = "<tr><td>";
        date_item += item;
        date_item += "</td><td><span class = 'glyphicon glyphicon-remove' id='" + tr_id + "' style = 'color:red;cursor:pointer;' onclick='removeDateItem( " + tr_id + " )'></span></td></tr>";

        array_date.push(item);

        $("#jo_date_list").append(date_item);
        $("#jo_absent_date_list").val(array_date);
        $("#jo_absent_date").val("");
        ComputeDeductions();
        ComputeTotalNetPay();
    });

    $("#jo_ewt,#jo_prof_tax,#jo_coop,#jo_other_adjustment,#jo_pagibig,#jo_phic,#jo_gsis,#jo_excess").change(function () {
        $(this).val(formatComma(roundOff($(this).val())));
        ComputeTotalNetPay();
    });
 
    function getLateAndAbsences(id, from, to)
    {
        $("#jo_create_payroll :input").attr("disabled", true);
        $(".create_payroll_spinner").removeClass("hidden");

        var url = "@Url.Action("GetMins","Home")";

       
       

        $.ajax({
            url: url,
            type: 'POST',
            data:
                {
                    "id": id,
                    "from":from,
                    "am_in": "08:00:00",
                    "am_out": "12:00:00",
                    "pm_in": "13:00:00",
                    "pm_out": "17:00:00",
                    "to": to
                },
            success: function (data) {
                var array_date = [];
                $("#jo_date_list").empty();
                $("#jo_absent_date_list").val("");

                var minutes_late = data.split(" ")[0];
                var working_days = data.split(" ")[1];
                var no_days_absent = data.split(" ")[2];

                for (var i = 0; i < no_days_absent.split("*").length; i++) {
                    var item = no_days_absent.split("*")[i];
                    if (item !== "") {
                        var date_item = "<tr><td>";
                        date_item += item;
                        date_item += "</td><td><span class = 'glyphicon glyphicon-remove' style = 'color:red;cursor:pointer;' id='" + i + "' onclick='removeDateItem( " + i + " )'></span></td>";

                        array_date.push(item);

                        $("#jo_date_list").append(date_item);
                        $("#jo_absent_date_list").val(array_date);
                        $('#jo_absent_date').val("");
                    }
                }
                $("#jo_minutes_late").val(minutes_late);
                $("#jo_working_days").val(working_days);

                ComputeDeductions();
                ComputeTotalNetPay();
               
                $(".create_payroll_spinner").addClass("hidden");
                $("#jo_create_payroll :input").attr("disabled", false);

            }
        });
    }

    function removeDateItem(id) {

          var tr = $("#" + id).closest('tr');
          var value = tr.find('td:eq(0)').text();

          tr.remove();

          var array_date = $("#jo_absent_date_list").val().split(',');
            

          for (var i = array_date.length - 1; i >= 0; i--) {
              
              if (array_date[i] === value) {
                  array_date.splice(i, 1);
                  break;
              }
          }

          $("#jo_absent_date_list").val(array_date);

          ComputeDeductions();
          ComputeTotalNetPay();
        
    }

    function removeItem(name, array_date) {
       
        return array_date;
    }

    function removeComma(number) {
        number = number.toString().replace(",", "");
        return number;
    }

    function formatComma(number) {
        number = number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        return number;
    }

    function daysInMonth(month, year) {
        return new Date(year, month, 0).getDate();
    }

    function roundOff(number) {
        number = (Math.round((parseFloat(number) + 0.00001) * 100) / 100)
        return parseFloat(number).toFixed(2);
    }

    function ComputeDeductions() {

            var salary = $("#jo_salary").val().replace(/,/g, '');
            var working_days = $("#jo_working_days").val().replace(/,/g, '');
            var minutes_late = $("#jo_minutes_late").val().replace(/,/g, '');
            var no_days_absent = ($("#jo_absent_date_list").val().length >= 4) ? $("#jo_absent_date_list").val().split(",").length : 0;
            var adjustment = $("#jo_adjustment").val().replace(/,/g, '');
            var deduction = "0.00";

            deduction = ((+minutes_late + (480 * +no_days_absent)) * (((+salary / +working_days) / 8) / 60));

           /* if (no_days_absent > 0) {
                deduction = ((+minutes_late + (480 * +no_days_absent)) * (((+salary / +working_days) / 8) / 60));
            } else {
                deduction = (+minutes_late * (((+salary / +working_days) / 8) / 60));
            }
            */

            if (isNaN(deduction) || !isFinite(deduction)) {
                deduction = "0.00";
            }

            deduction = roundOff(deduction);
            $("#jo_deduction").val(formatComma(deduction));

            
            var net_amount = 0.00;
            net_amount = ((parseFloat(salary) / 2) + parseFloat(adjustment)) - deduction;
            net_amount = roundOff(net_amount);

            $("#jo_net_amount").val(formatComma(net_amount));

            var jo_ewt = roundOff(net_amount * 0.05);
            var jo_prof_tax = roundOff(net_amount * 0.03);

            $("#jo_ewt").val(formatComma(jo_ewt));
            $("#jo_prof_tax").val(formatComma(jo_prof_tax));

            
    }

    function ComputeTotalNetPay() {

        var jo_net_amount = $("#jo_net_amount").val().replace(/,/g, '');
        var jo_ewt = $("#jo_ewt").val().replace(/,/g, '');
        var jo_prof_tax = $("#jo_prof_tax").val().replace(/,/g, '');

        var coop = $("#jo_coop").val().replace(/,/g, '');
        var other_adjustment = $("#jo_other_adjustment").val().replace(/,/g, '');
        var pagibig = $("#jo_pagibig").val().replace(/,/g, '');
        var phic = $("#jo_phic").val().replace(/,/g, '');
        var gsis = $("#jo_gsis").val().replace(/,/g, '');
        var excess = $("#jo_excess").val().replace(/,/g, '');

        var total_deductions = roundOff(parseFloat(jo_ewt) + parseFloat(jo_prof_tax) + parseFloat(coop) + parseFloat(pagibig) + parseFloat(phic) + parseFloat(gsis) + parseFloat(excess));
        var total_amount = roundOff((parseFloat(other_adjustment) + parseFloat(jo_net_amount)) - total_deductions);

        $("#jo_total_deductions").val(formatComma(total_deductions));
        $("#jo_total_amount").val(formatComma(total_amount));
    }

    </script>
}